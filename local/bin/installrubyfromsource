#!/bin/zsh
set -e

TAG="v${1-$(getcurrentrubyversion | sed 's/\./_/g')}"
SOURCE="$HOME/.local/source/ruby"

mkdir -p "$(dirname "$SOURCE")"
if [ ! -d "$SOURCE" ]; then
  git clone https://github.com/ruby/ruby "$SOURCE"
fi
cd "$SOURCE"
git fetch origin
git reset --hard

sudo apt-get -y build-dep ruby2.3

git checkout "$TAG"
autoconf
./configure --prefix="$PREFIX"

make clean
make
make install
